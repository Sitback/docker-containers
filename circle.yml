machine:
  ruby:
    version: 2.1.0
  services:
    - docker

dependencies:
  post:
    - bundle exec rake docker:ci_build

test:
  override:
    - bundle exec rspec --format RspecJunitFormatter --out $CIRCLE_TEST_REPORTS/rspec.xml:
        parallel: true
        files:
          - spec/soe/php55_spec.rb
          - spec/soe/php54_spec.rb
          - spec/soe/php53_spec.rb

deployment:
  hub:
    branch: master
    commands:
      - bundle exec rake docker:publish
